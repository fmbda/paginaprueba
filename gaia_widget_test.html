<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Prueba del widget GAIA ‚Äì tawk.to</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {font-family: system-ui, sans-serif; margin: 2rem; background:#f9fafb; color:#111827;}
    h1 {font-size: 1.5rem; margin-bottom: .5rem;}
    p {margin-bottom: 1rem;}
    code {background:#e5e7eb; padding:2px 4px; border-radius:4px;}
    footer {margin-top:3rem; font-size:.875rem; color:#6b7280;}
  </style>
</head>
<body>
  <h1>Prueba local del widget GAIA</h1>
  <p>Esta p√°gina embebe el widget de <a href="https://www.tawk.to" target="_blank">tawk.to</a> vinculado a tu propiedad de GAIA. Abr√≠ el chat (esquina inferior derecha) para probar la integraci√≥n y verificar que recib√≠s el <em>chatId</em>, nombre y otros metadatos.</p>
  <p><strong>üìå Pasos previos</strong></p>
  <ol>
    <li>En el dashboard de tawk.to copi√° el <code>propertyId</code> y <code>widgetId</code> de la propiedad que usa la nueva versi√≥n de GAIA.</li>
    <li>Reemplaz√° los placeholders <code>PROPERTY_ID</code> y <code>WIDGET_ID</code> en el script de abajo.</li>
    <li>Si quer√©s forzar datos de prueba (nombre, email, empresa), complet√° el objeto <code>Tawk_API.visitor</code>.</li>
    <li>Guard√° este archivo y abrilo con el explorador o servilo con <code>python -m http.server</code>.</li>
  </ol>

  <!-- Inicio del script del widget -->
  <script type="text/javascript">
    // API global de tawk
    var Tawk_API = Tawk_API || {};
    Tawk_LoadStart = new Date();

    /*
       ‚öôÔ∏è Datos opcionales para la sesi√≥n de visitante.
       Si ten√©s el modo seguro (Secure Mode) activado, agreg√° la propiedad "hash" correspondiente.
    */
    Tawk_API.visitor = {
      name : 'Tester Local',
      email : 'tester@example.com',
      empresa : 'Itris (demo)'
      // hash : 'HMAC_SHA256(...)'
    };

    // Callback cuando el widget termine de cargar
    Tawk_API.onLoad = function () {
      console.log('[GAIA] Widget cargado');
    };

    Tawk_API.onChatStarted = function () {
      console.log('[GAIA] Chat iniciado');
    
      setTimeout(() => {
        if (typeof Tawk_API.getConversationID === 'function') {
          let chatId = Tawk_API.getConversationID();
          console.log('[GAIA] ChatID detectado:', chatId || '(no disponible a√∫n)');
          window.GAIA_CHAT_ID = chatId;
        } else {
          console.log('[GAIA] Funci√≥n getConversationID no disponible');
        }
      }, 2000); // espera 2 segundos antes de intentar obtenerlo
    };

    // Inserci√≥n as√≠ncrona del script de tawk
    (function() {
      var s1 = document.createElement('script'), s0 = document.getElementsByTagName('script')[0];
      s1.async = true;
      // üîÑ Reemplaz√° PROPERTY_ID y WIDGET_ID
      s1.src = 'https://embed.tawk.to/56424e738fe02a613d44bde2/1j1avfmhf';
      s1.charset = 'UTF-8';
      s1.setAttribute('crossorigin', '*');
      s0.parentNode.insertBefore(s1, s0);
    })();
  </script>
  <!-- Fin del script del widget -->

  <footer>
    <p>¬© Itris ‚Äì P√°gina de pruebas local. Basado en la documentaci√≥n oficial de la <em>JavaScript API</em> y <em>Webhooks</em> de tawk.to.</p>
  </footer>
</body>
</html>
